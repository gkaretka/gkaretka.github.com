<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Hello, world!</title>
</head>

<body>
    <!-- Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.min.js"></script>

    <!-- Lodash -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
        </script>

    <div id="app">
        <div class="container">
            <!-- NAV bar -->
            <nav class="navbar navbar-dark bg-dark navbar-expand-lg">
                <div class="container-fluid">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="./index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="./pll_calculator.html">PLL Calculator</a>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- PLL Calc 1 -->
            <div class="accordion accordion-flush" id="accordionPLLCalculator">
                <div class="accordion-item open">
                    <h2 class="accordion-header" id="flush-headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                            PLL Calculator for given values
                        </button>
                    </h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
                        data-bs-parent="#accordionPLLCalculator">
                        <div class="accordion-body">
                            <div class="row align-items-start">
                                <h4>Input parameters</h4>
                                Calculate output frequency and frequency step for Integer-N PLL.
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="p_id" class="form-label">P [-]</label>
                                        <input type="number" v-model="p" class="form-control" id="p_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="b_id" class="form-label">B [-]</label>
                                        <input type="number" v-model="b" class="form-control" id="b_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="r_id" class="form-label">R [-]</label>
                                        <input type="number" v-model="r" class="form-control" id="r_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="a_id" class="form-label">A [-]</label>
                                        <input type="number" v-model="a" class="form-control" id="a_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="fref_id" class="form-label">F<sub>ref</sub> [MHz]</label>
                                        <input type="number" v-model="fref" class="form-control" id="fref_id">
                                    </div>
                                </div>
                            </div>
                            <div class="row align-items-start">
                                <h4>Results</h2>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>F<sub>out</sub>: {{ fout }} [MHz]</p>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>N: {{ n }} [-]</p>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>&Delta;F: {{ f_delta_1 }} [MHz]</p>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PLL Calc 2 -->
                <div class="accordion-item open">
                    <h2 class="accordion-header" id="flush-headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                            PLL Calculator for constant frequency step
                        </button>
                    </h2>
                    <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo"
                        data-bs-parent="#accordionPLLCalculator">
                        <div class="accordion-body">
                            <div class="row align-items-start">
                                <h4>Input parameters</h4>
                                Calculate output frequency and frequency step for Integer-N PLL.
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="p_id" class="form-label">F<sub>out</sub> [MHz]</label>
                                        <input type="number" v-model="fout_2" class="form-control" id="p_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="b_id" class="form-label">&Delta;F [MHz]</label>
                                        <input type="number" v-model="f_delta_2" class="form-control" id="b_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="r_id" class="form-label">P [-]</label>
                                        <input type="number" v-model="p_2" class="form-control" id="r_id">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="a_id" class="form-label">F<sub>ref</sub> [MHz]</label>
                                        <input type="number" v-model="fref_2" class="form-control" id="a_id">
                                    </div>
                                </div>
                            </div>
                            <h4>Results</h2>
                                <div class="row align-items-start">
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>N: {{ n_2 }} [-]</p>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>R: {{ r_2 }} [-]</p>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>B: {{ b_ful }}, reminder {{ b_mod }} [-]</p>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>A: {{ a_2 }} [-]</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row align-items-start">
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>Resulting N: {{ result_n }} [-]</p>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="mb-3">
                                            <p>Resulting Fout: {{ result_fout }} [MHz]</p>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>

                <!-- Mixer calc -->
                <div class="accordion-item open">
                    <h2 class="accordion-header" id="flush-headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#headingThree" aria-expanded="false" aria-controls="headingThree">
                            Mixer visualizer calculator
                        </button>
                    </h2>
                    <div id="headingThree" class="accordion-collapse collapse" aria-labelledby="flush-headingThree"
                        data-bs-parent="#accordionPLLCalculator">
                        <div class="accordion-body">
                            <div class="row align-items-start">
                                <h4>Input parameters</h4>
                                Calculate mixer params.
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="f_lo" class="form-label">F<sub>out</sub> [MHz]</label>
                                        <input type="number" v-model="f_lo" class="form-control" id="f_lo">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="b_id" class="form-label">&Delta;F [MHz]</label>
                                        <input type="number" v-model="f_low" class="form-control" id="f_low">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="r_id" class="form-label">P [-]</label>
                                        <input type="number" v-model="f_high" class="form-control" id="f_high">
                                    </div>
                                </div>
                            </div>
                            <h4>BP filter params</h4>
                            <div class="row align-items-start">
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="f_lo" class="form-label">F [MHz] insertion_loss</label>
                                        <textarea type="text" v-model="s_params" class="form-control"
                                            id="s_param"></textarea>
                                    </div>
                                </div>
                            </div>

                            <h4>Results</h2>
                                <div class="row align-items-start">
                                    <canvas id="mixer_chart" width="400" height="400"></canvas>
                                </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</body>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            // first app
            p: '16',
            b: '15',
            r: '16',
            a: '0',
            fref: '25',
            f_delta_1: parseFloat('1.5625').toFixed(4),
            n: 0,

            // out
            fout: '375',
            n: '240',

            // second app
            f_delta_2: '1',
            fout_2: '375',
            p_2: '16',
            fref_2: '25',

            // out
            n_2: '375',
            r_2: '25',
            b_ful: '23',
            b_mod: '7',
            a_2: parseFloat('1.019021739').toFixed(4),

            result_n: parseFloat('369.0190217').toFixed(4),
            result_fout: parseFloat('369.0190217').toFixed(4),

            s_params: "",
            f_lo: '',
            f_low: '',
            f_high: '',

            s_labels: [],
            s_datas: [],

        },
        watch: {
            // calc for first app
            p: function (newV, oldV) { this.calc_1(); },
            b: function (newV, oldV) { this.calc_1(); },
            r: function (newV, oldV) { this.calc_1(); },
            a: function (newV, oldV) { this.calc_1(); },
            fref: function (newV, oldV) { this.calc_1(); },
            n: function (newV, oldV) { this.calc_1(); },

            // calc for second app
            f_delta_2: function (newV, oldV) { this.calc_2() },
            fout_2: function (newV, oldV) { this.calc_2() },
            p_2: function (newV, oldV) { this.calc_2() },
            fref_2: function (newV, oldV) { this.calc_2() },

            // mixer
            s_params: function (newV, oldV) { this.view_s_params(); },
        },
        created: function () {
            // _.debounce is a function provided by lodash to limit how
            // often a particularly expensive operation can be run.
            // In this case, we want to limit how often we access
            // yesno.wtf/api, waiting until the user has completely
            // finished typing before making the ajax request. To learn
            // more about the _.debounce function (and its cousin
            // _.throttle), visit: https://lodash.com/docs#debounce
            this.debouncedCalc = _.debounce(this.calc_1, 500);
            this.debouncedCalc = _.debounce(this.calc_2, 500);
        },
        methods: {
            calc_1: function () {
                this.n = ((parseFloat(this.b) * parseFloat(this.p)) + parseFloat(this.a)).toFixed(4);
                this.fout = ((parseFloat(this.n) * parseFloat(this.fref)) / parseFloat(this.r)).toFixed(4);
            },

            calc_2: function () {
                this.r_2 = (parseFloat(this.fref_2) / parseFloat(this.f_delta_2)).toFixed(4);
                this.n_2 = ((parseFloat(this.fout_2) * parseFloat(this.r_2)) / parseFloat(this.fref_2)).toFixed(4);
                this.b_ful = Math.floor((parseFloat(this.n_2) / parseFloat(this.p_2))).toFixed(4);
                this.b_mod = (parseFloat(this.n_2) % parseFloat(this.p_2)).toFixed(4);
                this.a_2 = (parseFloat(this.n_2) / (parseFloat(this.p_2) * parseFloat(this.b_ful))).toFixed(4);

                this.result_n = (parseFloat(this.b_ful) * parseFloat(this.p_2) + parseFloat(this.a_2)).toFixed(4);
                this.result_fout = ((parseFloat(this.result_n) * parseFloat(this.fref_2)) / parseFloat(this.r_2)).toFixed(4);
            },

            view_s_params: function () {
                var ndline_splitted = this.s_params.split("\n");

                removeData(myChart);

                for (var i = 0; i < ndline_splitted.length; i++) {
                    var space_splitted = ndline_splitted[i].split(' ');

                    addData(myChart, space_splitted[0], space_splitted[1])

                }
                myChart.update();
            }
        },
    });

    function addData(chart, label, data) {
        chart.data.labels.push(label);
        chart.data.datasets.forEach((dataset) => {
            dataset.data.push(data);
        });
        chart.update();
    }

    function removeData(chart) {
        chart.data.labels.pop();
        chart.data.datasets.forEach((dataset) => {
            dataset.data.pop();
        });
        chart.update();
    }

</script>

<script>
    const DATA_COUNT = 7;
    const NUMBER_CFG = { count: DATA_COUNT, min: -100, max: 100 };

    labels = app.s_labels;
    data = {
        labels: labels,
        datasets: [
            {
                label: 'Dataset 1',
                data: app.s_datas,
                borderColor: 'red',
                backgroundColor: 255,
            },
        ],
    };

    const config = {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Chart.js Line Chart'
                }
            },
            scales: {
                y: {
                    reverse: true
                },
            }
        },
    };



    const ctx = document.getElementById('mixer_chart');
    const myChart = new Chart(ctx, config);
</script>

</html>